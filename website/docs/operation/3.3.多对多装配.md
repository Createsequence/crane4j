## 多对多装配

<img src="https://img.xiajibagao.top/image-20230320105521429.png" alt="image-20230320105521429" style="zoom:33%;" />

多对多，即一次操作中可通过多个 key 值对应到多个数据源对象，这个定义跟一对多有点不一样，它适用的场合是 key 属性本身类型的数组或者集合这样的批量形式，比如实际场景中，会存在 `key` 字段是**集合数组或者按分隔符拼接的字符串格式**的情况，即这种情况下**一次操作就对应了多个 `key` 值**：

~~~java
private String idStr; // key字段为按分隔符拼接的字符串，比如：a, b, c
private Set<Integer> idList; // key字段为集合，比如：[a, b, c];
private Integer[] idArray; // key字段为数组，比如：[a, b, c];
~~~

针对多 `key` 值字段映射，需要指定专门的装配操作处理器 `ManyToManyAssembleOperationHandler`：

~~~java
public class StudentVO {
    @Assemble(
        container = "teacher", 
        props = @Mapping(src = "name", ref = "teacherNames"),
        handlerName = "manyToManyAssembleOperationHandler"
    )
    private String teacherIds; // 格式默认支持 1, 2, 3 格式
    private List<String> teacherNames; // 填充的格式默认为 src1, src2, src3
}
~~~

上述示例表示，根据 `teacherIds` 字段字符串中通过分隔符分割的多个 `key` 值，查出关联的多个 `Teacher` 对象，然后将 `Teacher` 集合映射为 `Teacher.name` 集合并塞入 `StudentVO.teacherNames` 字段中。

该字段映射同样**遵循普通字段映射的语义**，比如对象映射：

~~~java
public class StudentVO {
    @Assemble(
        container = "teacher", 
        props = @Mapping(ref = "teachers"),
        handlerName = "manyToManyAssembleOperationHandler"
    )
    private String teacherIds; // 格式默认支持 1, 2, 3 格式
    private List<Teacher> teachers;
}
~~~

在批量映射的情况下，返回的对象都将会是**数据源对象或数据源对象的属性集合**。

:::tip

关于多对多情况下的属性映射，请参见配置字段映射一节

:::