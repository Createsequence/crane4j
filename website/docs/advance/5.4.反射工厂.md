## 反射工厂

参照 mybatis，crane4j 也提供了一套类似反射工厂的组件，即属性操作者 `PropertyOperatior`。

它用于统一的管理框架各处的反射调用，包括装配操作执行器、拆卸操作执行器、方法数据源容器的分组以及自动填充切面中的包装类提取等功能都依赖它完成。

默认提供了四个实现：

- `AsmReflectPropertyOperator`：基于 `ReflectAsm` 的字节码反射属性操作者；
- `ReflectPropertyOperator`：基于原生反射的普通反射属性操作者；
- `MapAccessiblePropertyOperator`：装饰器，在原功能的基础上，支持读写 `Map` 集合；
- `ChainAccessiblePropertyOperator`：装饰器，在原功能的基础上，支持通过链式操作符读写嵌套对象属性；

**替换默认实现**

如果我们想要使用自定义的 `PropertyOperator` 替换默认的实现，可以在 Spring 配置类中重新声明一个 `PropertyOperator`：

~~~java
@Bean
public PropertyOperator customPropertyOperator() {
    return new CustomPropertyOperator();
}
~~~

如果在非 `Spring` 环境中，可以获取全局配置对象 `Crane4jGlobalConfiguration` 手动配置：

~~~java
SimpleCrane4jGlobalConfiguration configuration = SimpleCrane4jGlobalConfiguration.create();
configuration.setPropertyOperator(new CustomPropertyOperator());
~~~

**使用包装类增强**

如果我们不想自己重新再实现一遍支持 `Map` 读写，以及通过链式操作符读写嵌套对象属性的功能，可以使用默认的两个包装类对你的属性操作者进行增强：

~~~java
PropertyOperator operator = new CustomPropertyOperator();
operator = new MapAccessiblePropertyOperator(operator);
operator = new ChainAccessiblePropertyOperator(operator);
~~~

不过包装的时候要稍微注意一下顺序。