<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>设置操作触发条件 | Crane4j</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="CRANE4J_ICON.png">
    <meta name="description" content="Crane4j, 基于注解的数据关联框架">
    
    <link rel="preload" href="/crane4j/assets/css/0.styles.ff64e91f.css" as="style"><link rel="preload" href="/crane4j/assets/js/app.9ae70afb.js" as="script"><link rel="preload" href="/crane4j/assets/js/2.c1e52383.js" as="script"><link rel="preload" href="/crane4j/assets/js/32.6009ec4c.js" as="script"><link rel="prefetch" href="/crane4j/assets/js/10.11837cb8.js"><link rel="prefetch" href="/crane4j/assets/js/11.cb585d8a.js"><link rel="prefetch" href="/crane4j/assets/js/12.f6392698.js"><link rel="prefetch" href="/crane4j/assets/js/13.6e205ad4.js"><link rel="prefetch" href="/crane4j/assets/js/14.7e5e8231.js"><link rel="prefetch" href="/crane4j/assets/js/15.d9d7c9ff.js"><link rel="prefetch" href="/crane4j/assets/js/16.d06d0e6a.js"><link rel="prefetch" href="/crane4j/assets/js/17.46ed969e.js"><link rel="prefetch" href="/crane4j/assets/js/18.fb5ee694.js"><link rel="prefetch" href="/crane4j/assets/js/19.b8591e7f.js"><link rel="prefetch" href="/crane4j/assets/js/20.7aee4a96.js"><link rel="prefetch" href="/crane4j/assets/js/21.42e2918b.js"><link rel="prefetch" href="/crane4j/assets/js/22.d3b0f15c.js"><link rel="prefetch" href="/crane4j/assets/js/23.7028fd4d.js"><link rel="prefetch" href="/crane4j/assets/js/24.645043ed.js"><link rel="prefetch" href="/crane4j/assets/js/25.d79aec2c.js"><link rel="prefetch" href="/crane4j/assets/js/26.e20d6155.js"><link rel="prefetch" href="/crane4j/assets/js/27.f8aa1a09.js"><link rel="prefetch" href="/crane4j/assets/js/28.eae6db22.js"><link rel="prefetch" href="/crane4j/assets/js/29.a545517e.js"><link rel="prefetch" href="/crane4j/assets/js/3.3af7aa22.js"><link rel="prefetch" href="/crane4j/assets/js/30.97f5e4e9.js"><link rel="prefetch" href="/crane4j/assets/js/31.a4088187.js"><link rel="prefetch" href="/crane4j/assets/js/33.25a7b6ff.js"><link rel="prefetch" href="/crane4j/assets/js/34.069cb57f.js"><link rel="prefetch" href="/crane4j/assets/js/35.5f482761.js"><link rel="prefetch" href="/crane4j/assets/js/36.283b04a6.js"><link rel="prefetch" href="/crane4j/assets/js/37.710bff3a.js"><link rel="prefetch" href="/crane4j/assets/js/38.52246ae7.js"><link rel="prefetch" href="/crane4j/assets/js/39.14a0acbc.js"><link rel="prefetch" href="/crane4j/assets/js/4.481cd6a3.js"><link rel="prefetch" href="/crane4j/assets/js/40.af3bbb0a.js"><link rel="prefetch" href="/crane4j/assets/js/41.fcaf3f34.js"><link rel="prefetch" href="/crane4j/assets/js/42.42fd76b4.js"><link rel="prefetch" href="/crane4j/assets/js/43.6e680a88.js"><link rel="prefetch" href="/crane4j/assets/js/44.b2e15165.js"><link rel="prefetch" href="/crane4j/assets/js/45.e5229cc2.js"><link rel="prefetch" href="/crane4j/assets/js/46.af6e2716.js"><link rel="prefetch" href="/crane4j/assets/js/47.6c51a1ee.js"><link rel="prefetch" href="/crane4j/assets/js/48.35dff115.js"><link rel="prefetch" href="/crane4j/assets/js/49.f8bcf784.js"><link rel="prefetch" href="/crane4j/assets/js/5.a7d2e7dc.js"><link rel="prefetch" href="/crane4j/assets/js/50.7dc7e24d.js"><link rel="prefetch" href="/crane4j/assets/js/6.5ec23f4f.js"><link rel="prefetch" href="/crane4j/assets/js/7.5aa09574.js"><link rel="prefetch" href="/crane4j/assets/js/8.d5c1ca5e.js"><link rel="prefetch" href="/crane4j/assets/js/9.65d4d6f9.js">
    <link rel="stylesheet" href="/crane4j/assets/css/0.styles.ff64e91f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/crane4j/" class="home-link router-link-active"><!----> <span class="site-name">Crane4j</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/crane4j/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源码" class="dropdown-title"><span class="title">源码</span> <span class="arrow down"></span></button> <button type="button" aria-label="源码" class="mobile-dropdown-title"><span class="title">源码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/opengoofy/crane4j" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/CreateSequence/crane4j" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于作者" class="dropdown-title"><span class="title">关于作者</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于作者" class="mobile-dropdown-title"><span class="title">关于作者</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Createsequence/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/CreateSequence" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.xiajibagao.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/opengoofy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我们
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/crane4j/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源码" class="dropdown-title"><span class="title">源码</span> <span class="arrow down"></span></button> <button type="button" aria-label="源码" class="mobile-dropdown-title"><span class="title">源码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/opengoofy/crane4j" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/CreateSequence/crane4j" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于作者" class="dropdown-title"><span class="title">关于作者</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于作者" class="mobile-dropdown-title"><span class="title">关于作者</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Createsequence/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/CreateSequence" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.xiajibagao.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/opengoofy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我们
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/crane4j/user_guide/what_is_crane4j.html" class="sidebar-link">简介</a></li><li><a href="/crane4j/user_guide/basic_concept.html" class="sidebar-link">基本概念</a></li><li><a href="/crane4j/user_guide/operational_principle.html" class="sidebar-link">原理</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/crane4j/user_guide/getting_started/getting_started_abstract.html" class="sidebar-heading clickable"><span>快速开始</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>场景示例</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/crane4j/user_guide/faq.html" class="sidebar-link">常见问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/crane4j/basic/declare_assemble_operation.html" class="sidebar-link">声明装配操作</a></li><li><a href="/crane4j/basic/property_mapping.html" class="sidebar-link">配置属性映射</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/crane4j/basic/container/container_abstract.html" class="sidebar-heading clickable"><span>数据源容器</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/crane4j/basic/trigger_operation.html" class="sidebar-link">触发填充操作</a></li><li><a href="/crane4j/basic/operation_condition.html" aria-current="page" class="active sidebar-link">设置操作触发条件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/crane4j/basic/operation_condition.html#_1-使用" class="sidebar-link">1.使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/crane4j/basic/operation_condition.html#_1-1-配置" class="sidebar-link">1.1.配置</a></li><li class="sidebar-sub-header"><a href="/crane4j/basic/operation_condition.html#_1-2-绑定到操作" class="sidebar-link">1.2.绑定到操作</a></li><li class="sidebar-sub-header"><a href="/crane4j/basic/operation_condition.html#_1-3-取反" class="sidebar-link">1.3.取反</a></li><li class="sidebar-sub-header"><a href="/crane4j/basic/operation_condition.html#_1-4-组合" class="sidebar-link">1.4.组合</a></li><li class="sidebar-sub-header"><a href="/crane4j/basic/operation_condition.html#_1-5-注解的作用域" class="sidebar-link">1.5.注解的作用域</a></li></ul></li><li class="sidebar-sub-header"><a href="/crane4j/basic/operation_condition.html#_2-内置注解" class="sidebar-link">2.内置注解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/crane4j/basic/operation_condition.html#_2-1-当表达式结果为真" class="sidebar-link">2.1.当表达式结果为真</a></li><li class="sidebar-sub-header"><a href="/crane4j/basic/operation_condition.html#_2-2-当指定属性值等于指定值" class="sidebar-link">2.2.当指定属性值等于指定值</a></li><li class="sidebar-sub-header"><a href="/crane4j/basic/operation_condition.html#_2-3-当指定属性值非空" class="sidebar-link">2.3.当指定属性值非空</a></li><li class="sidebar-sub-header"><a href="/crane4j/basic/operation_condition.html#_2-4-当填充对象为指定类型" class="sidebar-link">2.4.当填充对象为指定类型</a></li><li class="sidebar-sub-header"><a href="/crane4j/basic/operation_condition.html#_2-5-当存在指定数据源容器" class="sidebar-link">2.5.当存在指定数据源容器</a></li></ul></li><li class="sidebar-sub-header"><a href="/crane4j/basic/operation_condition.html#_3-自定义条件" class="sidebar-link">3.自定义条件</a></li></ul></li><li><a href="/crane4j/basic/declare_disassemble_operation.html" class="sidebar-link">填充嵌套对象</a></li><li><a href="/crane4j/basic/assemble_operation_handler.html" class="sidebar-link">一对多&amp;多对多</a></li><li><a href="/crane4j/basic/operation_group.html" class="sidebar-link">分组填充</a></li><li><a href="/crane4j/basic/operation_sort.html" class="sidebar-link">顺序填充</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/crane4j/advanced/cache.html" class="sidebar-link">缓存</a></li><li><a href="/crane4j/advanced/combination_annotation.html" class="sidebar-link">组合注解</a></li><li><a href="/crane4j/advanced/callback_of_component.html" class="sidebar-link">组件的回调接口</a></li><li><a href="/crane4j/advanced/operation_annotation_handler.html" class="sidebar-link">注解处理器</a></li><li><a href="/crane4j/advanced/operator_interface.html" class="sidebar-link">使用抽象方法填充</a></li><li><a href="/crane4j/advanced/reflection_factory.html" class="sidebar-link">反射工厂</a></li><li><a href="/crane4j/advanced/type_converter.html" class="sidebar-link">类型转换</a></li><li><a href="/crane4j/advanced/async_executor.html" class="sidebar-link">异步填充</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>扩展插件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/crane4j/extension/mybatis_plus_extension.html" class="sidebar-link">MybatisPlus</a></li><li><a href="/crane4j/extension/jackson_extension.html" class="sidebar-link">Jackson</a></li><li><a href="/crane4j/extension/redis_extension.html" class="sidebar-link">Redis</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/crane4j/other/configuration_properties.html" class="sidebar-link">配置文件</a></li><li><a href="/crane4j/other/changelog.html" class="sidebar-link">更新日志</a></li><li><a href="/crane4j/other/community.html" class="sidebar-link">联系作者</a></li><li><a href="/crane4j/other/How-To-Ask-Questions-The-Smart-Way.html" class="sidebar-link">提问的智慧</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="设置操作触发条件"><a href="#设置操作触发条件" class="header-anchor">#</a> 设置操作触发条件</h1> <p>有时候，我们会需要根据动态的条件，选择性的填充一批对象中的某一部分，在 2.6.0 及以上版本，crane4j 通过一套类似 spring 条件装配的机制对此提供了支持。</p> <h2 id="_1-使用"><a href="#_1-使用" class="header-anchor">#</a> 1.使用</h2> <h3 id="_1-1-配置"><a href="#_1-1-配置" class="header-anchor">#</a> 1.1.配置</h3> <p>你可以直接在原配置的基础上添加注解，为操作<strong>指定触发条件</strong>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@ConditionOnExpression</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;#target.name != 'user'&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 仅当 name 属性为 user 时才应用操作</span>
    <span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@ConditionOnPropertyNotEmpty</span> <span class="token comment">// 仅当 nested 属性不为空时才应用操作</span>
    <span class="token annotation punctuation">@Disassemble</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Foo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Foo</span><span class="token punctuation">&gt;</span></span> foos<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>和操作注解一样，你也可以将其放置在类上：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConditionOnExpression</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;#target.name != 'user'&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果在操作者接口中，则可以放在方法上：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Operator</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OperatorInterface</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@ConditionOnExpression</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;#target.name != 'user'&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">fill</span><span class="token punctuation">(</span><span class="token class-name">Foo</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>关于在属性和类上声明操作配置，请参见 <a href="/crane4j/basic/declare_assemble_operation.html">声明装配操作</a> 与 <a href="/crane4j/basic/declare_disassemble_operation.html">声明拆卸操作</a> 一节；</li> <li>关于操作者接口，请参见 <a href="/crane4j/advanced/operator_interface.html">基于接口填充</a> 一节；</li></ul></div> <h3 id="_1-2-绑定到操作"><a href="#_1-2-绑定到操作" class="header-anchor">#</a> 1.2.绑定到操作</h3> <p>当你在类、属性或方法上指定触发条件时，若该元素上同时声明了多个操作，那么条件<strong>同时将应用到该元素上声明的所有操作</strong>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConditionOnExpression</span><span class="token punctuation">(</span>expression <span class="token operator">=</span> <span class="token string">&quot;#target.name != 'user'&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 该条件将同时应用到下面两个装配操作</span>
<span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> key<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过指定 <code>id</code>，你可以将条件绑定到指定的操作上，这样其他的操作就不会受到这个条件影响：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConditionOnExpression</span><span class="token punctuation">(</span>
    id <span class="token operator">=</span> <span class="token string">&quot;op1&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// 该条件仅应用到 op1</span>
    value <span class="token operator">=</span> <span class="token string">&quot;#target.name != 'user'&quot;</span>
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">&quot;op1&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">&quot;op2&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> key<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-3-取反"><a href="#_1-3-取反" class="header-anchor">#</a> 1.3.取反</h3> <p>你可以将注解的 <code>negate</code> 属性设置为 <code>true</code>，从而对条件取反：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// 下述条件等同于：code % 2 != 0</span>
    <span class="token annotation punctuation">@ConditionOnExpression</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;#target.code % 2 == 0&quot;</span><span class="token punctuation">,</span> negate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>container <span class="token operator">=</span> <span class="token constant">CONTAINER_NAME</span><span class="token punctuation">,</span> sort <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-4-组合"><a href="#_1-4-组合" class="header-anchor">#</a> 1.4.组合</h3> <p>你可以同时为操作应用多个条件，此时绑定到同一操作上的条件将会被合并为一个组合条件：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@ConditionOnExpression</span><span class="token punctuation">(</span><span class="token string">&quot;#target.code % 3 == 0&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionOnExpression</span><span class="token punctuation">(</span><span class="token string">&quot;#target.code % 2 == 0&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>container <span class="token operator">=</span> <span class="token constant">CONTAINER_NAME</span><span class="token punctuation">,</span> sort <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>你可以指定条件的类型为 <code>OR</code> 或 <code>AND</code>，并让它们以特定的顺序组合：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// 下述条件等同于： code != null || ((code % 3 == 0 &amp;&amp; code % 3 == 0) || code == 0)</span>
    
    <span class="token annotation punctuation">@ConditionOnPropertyNotNull</span><span class="token punctuation">(</span>
        type <span class="token operator">=</span> <span class="token class-name">ConditionType</span><span class="token punctuation">.</span><span class="token constant">OR</span><span class="token punctuation">,</span>
        sort <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionOnExpression</span><span class="token punctuation">(</span>
        value <span class="token operator">=</span> <span class="token string">&quot;#target.code % 3 == 0&quot;</span>
        sort <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionOnExpression</span><span class="token punctuation">(</span>
        value <span class="token operator">=</span> <span class="token string">&quot;#target.code % 2 == 0&quot;</span><span class="token punctuation">,</span>
        type <span class="token operator">=</span> <span class="token class-name">ConditionType</span><span class="token punctuation">.</span><span class="token constant">AND</span><span class="token punctuation">,</span>
        sort <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionOnExpression</span><span class="token punctuation">(</span>
        value <span class="token operator">=</span> <span class="token string">&quot;#target.code == 0&quot;</span><span class="token punctuation">,</span>
        type <span class="token operator">=</span> <span class="token class-name">ConditionType</span><span class="token punctuation">.</span><span class="token constant">OR</span><span class="token punctuation">,</span>
        sort <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>当条件你有较为复杂的判断逻辑时，你也可以选择令目标类实现 <code>OperationAwareBean</code> 接口或  <code>SmartOperationAwareBean</code> 接口，直接通过编码来进行判断。相比起注解式配置，会更加灵活而直观。</p> <p>具体内容可参见 <a href="/crane4j/advanced/callback_of_component.html">组件的回调接口</a> 一节中的 “对象回调接口” 这一小节。</p></div> <h3 id="_1-5-注解的作用域"><a href="#_1-5-注解的作用域" class="header-anchor">#</a> 1.5.注解的作用域</h3> <p>操作条件的作用域总是仅限于该注解所在的元素本身。</p> <p>简单的来说，你在属性上添加了条件注解，那么这个条件注解<strong>仅允许对同一个属性上声明的操作生效</strong>，类或方法同理：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConditionOnExpression</span><span class="token punctuation">(</span> <span class="token comment">// 该条件不会生效，因为该注解下面两个操作配置没有被声明在同一个元素上</span>
    id <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;op1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;op2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    value <span class="token operator">=</span> <span class="token string">&quot;#target.name != 'user'&quot;</span><span class="token punctuation">,</span>
    
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">&quot;op1&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">&quot;op2&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> key<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_2-内置注解"><a href="#_2-内置注解" class="header-anchor">#</a> 2.内置注解</h2> <h3 id="_2-1-当表达式结果为真"><a href="#_2-1-当表达式结果为真" class="header-anchor">#</a> 2.1.当表达式结果为真</h3> <p>参见 <code>@ConditionOnExpression</code> 注解。</p> <p>运行时，crane4j 将根据指定表达式的执行结果确认是否要应用对应的操作：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ConditionOnExpression</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;#target.name != 'user'&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 仅当 name 属性为 user 时才应用操作</span>
    <span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>表达式的语法取决于你的表达式引擎，在 Spring 环境中，默认使用 SpEL，而在非 Spring 环境中，则使用 Ognl。</p> <p>不管哪一个表达式，都默认注册了 <code>target</code> 变量，你可以在表达式中通过 <code>target</code> 引用当前要填充的对象。</p> <h3 id="_2-2-当指定属性值等于指定值"><a href="#_2-2-当指定属性值等于指定值" class="header-anchor">#</a> 2.2.当指定属性值等于指定值</h3> <p>参见 <code>@ConditionOnProperty</code> 注解。</p> <p>运行时，crane4j 将根据指定属性值是否等于期望值确认是否要应用对应的操作：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConditionOnProperty</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> value <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 仅当 key 属性为 user 时才应用操作</span>
<span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@ConditionOnProperty</span><span class="token punctuation">(</span>value <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 仅当 name 属性为 user 时才应用操作</span>
    <span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">String</span> key<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>类型转换</strong></p> <p>crane4j 默认会将 <code>value</code> 指定的期望值转为实际值的类型后再进行比较。你可以手动指定期望值类型，避免每次判断都要进行类型转换：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ConditionOnProperty</span><span class="token punctuation">(</span>value <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> valueType <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// 仅当 id 属性为 123 时才应用操作</span>
    <span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>空值判断</strong></p> <p>默认情况下，如果实际值为 <code>null</code>，则认为条件不通过。如果你希望允许空值，那么可以将 <code>enableNull</code> 设置为 <code>true</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ConditionOnProperty</span><span class="token punctuation">(</span>
        value <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> 
        valueType <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        enableNull <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 当 id 为空时仍然应用该操作</span>
    <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意，当 <code>enableNull</code> 设置为 <code>false</code> 时，实际上判断条件是 <code>property != null &amp;&amp; expect.equals(property)</code>。</p> <p>如果此时你又指定 <code>negate</code> 属性为 <code>true</code> 进行取反，那么最终的判断条件就是 <code>property == null || !expect.equals(property)</code>，即 <code>!(property != null &amp;&amp; expect.equals(property))</code>。</p></div> <h3 id="_2-3-当指定属性值非空"><a href="#_2-3-当指定属性值非空" class="header-anchor">#</a> 2.3.当指定属性值非空</h3> <p>参见 <code>@ConditionOnPropertyNotEmpty</code> 与 <code>@ConditionOnPropertyNotNull</code> 注解。</p> <p>运行时，crane4j 将根据指定属性值是否为空确认是否要应用对应的操作：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConditionOnPropertyNotEmpty</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;keys&quot;</span><span class="token punctuation">,</span> value <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 仅当 keys 属性不为空才应用操作</span>
<span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">&quot;keys&quot;</span><span class="token punctuation">,</span> container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@ConditionOnPropertyNotNull</span><span class="token punctuation">(</span>value <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 仅当 name 属性不为null时才应用操作</span>
    <span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keys<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中，<code>@ConditionOnPropertyNotEmpty</code> 可以判断数组、集合或字符串是否为空，而 <code>@ConditionOnPropertyNotNull</code> 只能判断是否为 <code>null</code>。</p> <h3 id="_2-4-当填充对象为指定类型"><a href="#_2-4-当填充对象为指定类型" class="header-anchor">#</a> 2.4.当填充对象为指定类型</h3> <p>参见 <code>@ConditionOnTargetType</code> 注解。</p> <p>运行时，crane4j 将根据目标对象是否属于指定类型确认是否要应用对应的操作：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Operator</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OperatorInterface</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@ConditionOnTargetType</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Foo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// 仅当填充对象类型为 Foo 及其子类时生效</span>
    <span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">fill</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> targets<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>默认情况下，上述条件等同于 <code>target instanceof FooChild</code>，如果你希望严格的匹配类型，则可以将 <code>strict</code> 设置为 <code>true</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Operator</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OperatorInterface</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@ConditionOnTargetType</span><span class="token punctuation">(</span> <span class="token comment">// 仅当填充对象类型为 Foo 时才生效，Foo 及其子类不生效</span>
        value <span class="token operator">=</span> <span class="token class-name">Foo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        strict <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">fill</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> targets<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-5-当存在指定数据源容器"><a href="#_2-5-当存在指定数据源容器" class="header-anchor">#</a> 2.5.当存在指定数据源容器</h3> <p>参见 <code>@ConditionOnContainer</code> 注解。</p> <p>运行时，crane4j 将当前是否有特定的数据源容器确认是否要应用对应的操作：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Operator</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OperatorInterface</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@ConditionOnContainer</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 仅当存在 namespace 为 foo 的数据源容器时才生效</span>
    <span class="token annotation punctuation">@Assemble</span><span class="token punctuation">(</span>container <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_3-自定义条件"><a href="#_3-自定义条件" class="header-anchor">#</a> 3.自定义条件</h2> <p>如果有必要，你也可以自定义一个条件注解，实现自己的条件逻辑。</p> <p>比如，我们要定义一个条件，即仅当目标对象实现了 <code>Serializable</code> 接口时才允许进行填充，那么总共需要三步：</p> <p><strong>自定义注解</strong></p> <p>首先，定义一个条件注解 <code>@ConditionOnTargetSerializable</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">ANNOTATION_TYPE</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">FIELD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">ConditionOnTargetSerializable</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">ConditionType</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">ConditionType</span><span class="token punctuation">.</span><span class="token constant">AND</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">negate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>实现注解解析器</strong></p> <p>然后，你需要实现 <code>ConditionParser</code> 接口，定义一个用于解析 <code>@ConditionOnTargetSerializable</code> 注解的解析器。</p> <p>为了简化代码，crane4j 默认提供了 <code>AbstractConditionParser</code> 模板类，它已经实现好了大部分逻辑，你仅需要让自己的实现类继承它并实现关键的抽象方法即可：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConditionOnTargetSerializableParser</span>
    <span class="token keyword">extends</span> <span class="token class-name">AbstractConditionParser</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConditionOnTargetSerializable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    
    <span class="token keyword">public</span> <span class="token class-name">TargetSerializableConditionParser</span><span class="token punctuation">(</span><span class="token class-name">AnnotationFinder</span> annotationFinder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>annotationFinder<span class="token punctuation">,</span> <span class="token class-name">ConditionOnTargetSerializable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@NonNull</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">ConditionDescriptor</span> <span class="token function">getConditionDescriptor</span><span class="token punctuation">(</span><span class="token class-name">ConditionOnTargetSerializable</span> annotation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ConditionDescriptor</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">boundOperationIds</span><span class="token punctuation">(</span>annotation<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 条件要绑定到哪些操作上</span>
            <span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span>annotation<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 当有多个条件时，该条件应该是 AND 还是 OR</span>
            <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>annotation<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 当有多个条件时，该条件应该排在第几个</span>
            <span class="token punctuation">.</span><span class="token function">negate</span><span class="token punctuation">(</span>annotation<span class="token punctuation">.</span><span class="token function">negate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 该条件是否需要取反</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Nullable</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AbstractCondition</span> <span class="token function">createCondition</span><span class="token punctuation">(</span>
        <span class="token class-name">AnnotatedElement</span> element<span class="token punctuation">,</span> <span class="token class-name">ConditionOnTargetSerializable</span> annotation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AbstractCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">KeyTriggerOperation</span> operation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> target <span class="token keyword">instanceof</span> <span class="token class-name">Serializable</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>注册注解解析器</strong></p> <p>要令自定义注解解析器生效，你需要将其注册到 <code>ConditionalTypeHierarchyBeanOperationParser</code> 中。</p> <p>在 Spring 环境，你只需要把自定义的注解解析器交给 Spring 管理即可，crane4j 会自行完成注册。</p> <p>而在非 Spring 环境中，你需要通过全局配置获取该组件，并手动完成注册：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Crane4jGlobalConfiguration</span> configuration <span class="token operator">=</span> <span class="token class-name">SimpleCrane4jGlobalConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ConditionalTypeHierarchyBeanOperationParser</span> parser <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">getBeanOperationParser</span><span class="token punctuation">(</span><span class="token class-name">ConditionalTypeHierarchyBeanOperationParser</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
parser<span class="token punctuation">.</span><span class="token function">registerConditionParser</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConditionOnTargetSerializableParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/crane4j/basic/trigger_operation.html" class="prev">
        触发填充操作
      </a></span> <span class="next"><a href="/crane4j/basic/declare_disassemble_operation.html">
        填充嵌套对象
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/crane4j/assets/js/app.9ae70afb.js" defer></script><script src="/crane4j/assets/js/2.c1e52383.js" defer></script><script src="/crane4j/assets/js/32.6009ec4c.js" defer></script>
  </body>
</html>
