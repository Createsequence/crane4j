<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>缓存 | Crane4j</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="CRANE4J_ICON.png">
    <meta name="description" content="Crane4j, 基于注解的数据关联框架">
    
    <link rel="preload" href="/crane4j/assets/css/0.styles.ff64e91f.css" as="style"><link rel="preload" href="/crane4j/assets/js/app.143d5804.js" as="script"><link rel="preload" href="/crane4j/assets/js/2.c1e52383.js" as="script"><link rel="preload" href="/crane4j/assets/js/11.953399d4.js" as="script"><link rel="prefetch" href="/crane4j/assets/js/10.266533a8.js"><link rel="prefetch" href="/crane4j/assets/js/12.9b005dc1.js"><link rel="prefetch" href="/crane4j/assets/js/13.d2502fa9.js"><link rel="prefetch" href="/crane4j/assets/js/14.4617e082.js"><link rel="prefetch" href="/crane4j/assets/js/15.424ccc72.js"><link rel="prefetch" href="/crane4j/assets/js/16.7fb2b0d5.js"><link rel="prefetch" href="/crane4j/assets/js/17.a0421c26.js"><link rel="prefetch" href="/crane4j/assets/js/18.5262b7f7.js"><link rel="prefetch" href="/crane4j/assets/js/19.d19f8a9d.js"><link rel="prefetch" href="/crane4j/assets/js/20.9a97a726.js"><link rel="prefetch" href="/crane4j/assets/js/21.81bb469c.js"><link rel="prefetch" href="/crane4j/assets/js/22.dfc3c9a4.js"><link rel="prefetch" href="/crane4j/assets/js/23.7ee6505e.js"><link rel="prefetch" href="/crane4j/assets/js/24.8d83003c.js"><link rel="prefetch" href="/crane4j/assets/js/25.883f2e5d.js"><link rel="prefetch" href="/crane4j/assets/js/26.68068092.js"><link rel="prefetch" href="/crane4j/assets/js/27.17cfb2fa.js"><link rel="prefetch" href="/crane4j/assets/js/28.e061b890.js"><link rel="prefetch" href="/crane4j/assets/js/29.150121e2.js"><link rel="prefetch" href="/crane4j/assets/js/3.d4d0b078.js"><link rel="prefetch" href="/crane4j/assets/js/30.d544e44f.js"><link rel="prefetch" href="/crane4j/assets/js/31.0ae6fd30.js"><link rel="prefetch" href="/crane4j/assets/js/32.92127967.js"><link rel="prefetch" href="/crane4j/assets/js/33.12db17b6.js"><link rel="prefetch" href="/crane4j/assets/js/34.e38a4265.js"><link rel="prefetch" href="/crane4j/assets/js/35.01082582.js"><link rel="prefetch" href="/crane4j/assets/js/36.dbc89363.js"><link rel="prefetch" href="/crane4j/assets/js/37.4caabf29.js"><link rel="prefetch" href="/crane4j/assets/js/38.473703a6.js"><link rel="prefetch" href="/crane4j/assets/js/39.4ccb3d41.js"><link rel="prefetch" href="/crane4j/assets/js/4.481cd6a3.js"><link rel="prefetch" href="/crane4j/assets/js/40.d940e126.js"><link rel="prefetch" href="/crane4j/assets/js/41.121006a5.js"><link rel="prefetch" href="/crane4j/assets/js/42.9c4b1d23.js"><link rel="prefetch" href="/crane4j/assets/js/43.f4dedd0b.js"><link rel="prefetch" href="/crane4j/assets/js/44.a8a76611.js"><link rel="prefetch" href="/crane4j/assets/js/45.09ed7e08.js"><link rel="prefetch" href="/crane4j/assets/js/46.7f25dc85.js"><link rel="prefetch" href="/crane4j/assets/js/47.41cac14e.js"><link rel="prefetch" href="/crane4j/assets/js/5.a7d2e7dc.js"><link rel="prefetch" href="/crane4j/assets/js/6.e94b337b.js"><link rel="prefetch" href="/crane4j/assets/js/7.eb9eef5d.js"><link rel="prefetch" href="/crane4j/assets/js/8.320bed64.js"><link rel="prefetch" href="/crane4j/assets/js/9.65d4d6f9.js">
    <link rel="stylesheet" href="/crane4j/assets/css/0.styles.ff64e91f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/crane4j/" class="home-link router-link-active"><!----> <span class="site-name">Crane4j</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/crane4j/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源码" class="dropdown-title"><span class="title">源码</span> <span class="arrow down"></span></button> <button type="button" aria-label="源码" class="mobile-dropdown-title"><span class="title">源码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/opengoofy/crane4j" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/CreateSequence/crane4j" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于作者" class="dropdown-title"><span class="title">关于作者</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于作者" class="mobile-dropdown-title"><span class="title">关于作者</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Createsequence/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/CreateSequence" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.xiajibagao.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/opengoofy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我们
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/crane4j/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源码" class="dropdown-title"><span class="title">源码</span> <span class="arrow down"></span></button> <button type="button" aria-label="源码" class="mobile-dropdown-title"><span class="title">源码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/opengoofy/crane4j" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/CreateSequence/crane4j" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于作者" class="dropdown-title"><span class="title">关于作者</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于作者" class="mobile-dropdown-title"><span class="title">关于作者</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Createsequence/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/CreateSequence" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.xiajibagao.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/opengoofy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我们
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/crane4j/user_guide/what_is_crane4j.html" class="sidebar-link">简介</a></li><li><a href="/crane4j/user_guide/basic_concept.html" class="sidebar-link">基本概念</a></li><li><a href="/crane4j/user_guide/operational_principle.html" class="sidebar-link">原理</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/crane4j/user_guide/getting_started/getting_started_abstract.html" class="sidebar-heading clickable"><span>快速开始</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>场景示例</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/crane4j/user_guide/faq.html" class="sidebar-link">常见问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/crane4j/basic/declare_assemble_operation.html" class="sidebar-link">声明装配操作</a></li><li><a href="/crane4j/basic/multi_assemble_operation.html" class="sidebar-link">配置属性映射</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/crane4j/basic/container/container_abstract.html" class="sidebar-heading clickable"><span>数据源容器</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/crane4j/basic/trigger_operation.html" class="sidebar-link">触发填充操作</a></li><li><a href="/crane4j/basic/declare_disassemble_operation.html" class="sidebar-link">填充嵌套对象</a></li><li><a href="/crane4j/basic/multi_assemble_operation.html" class="sidebar-link">一对一&amp;多对多</a></li><li><a href="/crane4j/basic/operation_group.html" class="sidebar-link">分组填充</a></li><li><a href="/crane4j/basic/operation_sort.html" class="sidebar-link">顺序填充</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/crane4j/advanced/cache.html" aria-current="page" class="active sidebar-link">缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/crane4j/advanced/cache.html#_1-cachemanager" class="sidebar-link">1.CacheManager</a></li><li class="sidebar-sub-header"><a href="/crane4j/advanced/cache.html#_2-结合数据源容器使用" class="sidebar-link">2.结合数据源容器使用</a></li><li class="sidebar-sub-header"><a href="/crane4j/advanced/cache.html#_3-配置缓存容器" class="sidebar-link">3.配置缓存容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/crane4j/advanced/cache.html#手动替换" class="sidebar-link">手动替换</a></li><li class="sidebar-sub-header"><a href="/crane4j/advanced/cache.html#添加注解" class="sidebar-link">添加注解</a></li><li class="sidebar-sub-header"><a href="/crane4j/advanced/cache.html#配置文件" class="sidebar-link">配置文件</a></li></ul></li></ul></li><li><a href="/crane4j/advanced/combination_annotation.html" class="sidebar-link">组合注解</a></li><li><a href="/crane4j/advanced/container_lifecycle.html" class="sidebar-link">容器的生命周期</a></li><li><a href="/crane4j/advanced/operation_annotation_handler.html" class="sidebar-link">注解处理器</a></li><li><a href="/crane4j/advanced/operator_interface.html" class="sidebar-link">使用抽象方法填充</a></li><li><a href="/crane4j/advanced/reflection_factory.html" class="sidebar-link">反射工厂</a></li><li><a href="/crane4j/advanced/type_converter.html" class="sidebar-link">类型转换</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>扩展插件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/crane4j/extension/mybatis_plus_extension.html" class="sidebar-link">MybatisPlus</a></li><li><a href="/crane4j/extension/jackson_extension.html" class="sidebar-link">Jackson</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/crane4j/other/configuration_properties.html" class="sidebar-link">配置文件</a></li><li><a href="/crane4j/other/changelog.html" class="sidebar-link">更新日志</a></li><li><a href="/crane4j/other/community.html" class="sidebar-link">联系作者</a></li><li><a href="/crane4j/other/How-To-Ask-Questions-The-Smart-Way.html" class="sidebar-link">提问的智慧</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="缓存"><a href="#缓存" class="header-anchor">#</a> 缓存</h1> <p>在 <code>crane4j</code> 中，每个缓存对应一个 <code>Cache</code> 对象，用于提供缓存的读写功能。数据源容器通过持有 <code>Cache</code> 对象来实现对缓存的操作。所有的 <code>Cache</code> 对象都由全局的缓存管理器 <code>CacheManager</code> 进行管理。</p> <p>缓存管理器 <code>CacheManager</code> 负责创建、配置和管理缓存对象。它提供了一组接口和方法，用于获取、创建、删除和管理缓存。通过 <code>CacheManager</code>，我们可以对缓存进行统一的管理和控制。</p> <p>下图展示了 <code>Cache</code>、数据源容器和缓存管理器之间的关系：</p> <p><img src="https://img.xiajibagao.top/image-20230225011748030.png" alt="缓存结构"></p> <p>在这个结构中，数据源容器通过 <code>Cache</code> 对象与缓存进行交互，而 <code>Cache</code> 对象则由缓存管理器 <code>CacheManager</code> 管理和配置。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在目前的版本中，由于缺乏 redis 支持，以及缺少细粒度控制缓存过期时间等原因，缓存的实用价值依然有限，在后续版本将会进一步完善它。</p></div> <h2 id="_1-cachemanager"><a href="#_1-cachemanager" class="header-anchor">#</a> 1.CacheManager</h2> <p>在 <code>crane4j</code> 中，缓存功能由缓存管理器 <code>CacheManager</code> 和具体的缓存对象 <code>Cache</code> 共同完成。缓存管理器负责管理缓存对象的创建和销毁，而缓存对象提供具体的读写功能。</p> <p><code>crane4j</code> 默认提供了两种缓存管理器实现：</p> <ul><li><code>ConcurrentMapCacheManager</code>：基于 <code>WeakConcurrentMap</code> 实现的缓存对象，无法设置过期策略，只能依赖 JVM 自动回收缓存。它是默认的缓存管理器；</li> <li><code>GuavaCacheManager</code>：基于 <code>Guava</code> 的 <code>Cache</code> 实现的缓存对象，支持配置过期时间和并发等级等选项；</li></ul> <p>要替换默认的缓存管理器，可以在配置类中声明一个 <code>GuavaCacheManager</code> 实例，并将其作为 Bean 注册到 Spring 上下文中。通过自定义的 <code>GuavaCacheManager</code>，可以配置自定义的缓存过期时间和并发级别等参数。</p> <p>在使用缓存时，可以通过缓存管理器 <code>CacheManager</code> 创建和获取缓存对象 <code>Cache</code>，然后使用 <code>Cache</code> 对象进行缓存的读写和销毁操作。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 获取名为 &quot;foo&quot; 的缓存对象</span>
<span class="token class-name">Cache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> cacheManager<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用缓存对象进行读写操作</span>
cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;cacheKey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;cacheKey&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cacheValue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 销毁名为 &quot;foo&quot; 的缓存对象</span>
cacheManager<span class="token punctuation">.</span><span class="token function">removeCache</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>需要注意的是，销毁缓存对象后，之前获取到的缓存对象仍然可以使用，但是数据可能已被清空。可以通过 <code>Cache.isExpired()</code> 方法判断缓存是否已过期。</p> <p>缓存管理器和缓存对象一般不直接使用，而是与缓存容器等机制结合使用，以实现更高级的缓存功能。</p> <h2 id="_2-结合数据源容器使用"><a href="#_2-结合数据源容器使用" class="header-anchor">#</a> 2.结合数据源容器使用</h2> <p>在 <code>crane4j</code> 中，数据源缓存容器基于缓存容器包装类 <code>CacheableContainer</code> 实现，它可以包装任何容器，使其具备缓存功能。</p> <p>下面是创建数据源缓存容器的示例代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 1、创建一个原始容器</span>
<span class="token class-name">Container</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> original <span class="token operator">=</span> <span class="token class-name">LambdaContainer</span><span class="token punctuation">.</span><span class="token function">forLambda</span><span class="token punctuation">(</span><span class="token string">&quot;original&quot;</span><span class="token punctuation">,</span> keys <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">///2、获取缓存管理器</span>
<span class="token class-name">CacheManager</span> cacheManager <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">CacheManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3、基于原始容器与缓存对象，构建带有缓存功能的容器</span>
<span class="token class-name">CacheableContainer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheableContainer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>original<span class="token punctuation">,</span> cacheManager<span class="token punctuation">,</span> <span class="token string">&quot;cacheName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在上述示例中，通过 <code>LambdaContainer</code> 创建了一个原始容器 <code>original</code>，然后使用缓存管理器 <code>CacheManager</code> 和指定的缓存对象名称 <code>&quot;cacheName&quot;</code>，构建了带有缓存功能的容器 <code>container</code>。</p> <p>容器缓存的粒度是 key 级别，即第一次查询 a、b，则会对 a、b 进行查询并缓存。第二次查询 a、b、c 时，只会查询 c 并将其增量添加到缓存中，而 a、b 则直接从缓存中获取。</p> <h2 id="_3-配置缓存容器"><a href="#_3-配置缓存容器" class="header-anchor">#</a> 3.配置缓存容器</h2> <p>在 <code>crane4j</code> 中，你可以通过三种方式将一个普通容器配置为缓存容器。</p> <h3 id="手动替换"><a href="#手动替换" class="header-anchor">#</a> 手动替换</h3> <p>可以获取全局配置类 <code>Crane4jGlobalConfiguration</code>，然后使用 <code>replaceContainer</code> 方法将原始的容器替换为包装后的缓存容器。</p> <p>示例代码如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Crane4jGlobalConfiguration</span> configuration <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">Crane4jGlobalConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CacheManager</span> cacheManager <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">CacheManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将原始容器包装并替换为缓存容器</span>
configuration<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token string">&quot;namespace&quot;</span><span class="token punctuation">,</span> container <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CacheableContainer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Container</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> container<span class="token punctuation">,</span> cacheManager<span class="token punctuation">,</span> <span class="token string">&quot;cacheName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在上述示例中，使用 <code>Crane4jGlobalConfiguration</code> 获取全局配置类实例，然后通过 <code>replaceContainer</code> 方法将指定命名空间的原始容器替换为缓存容器。需要传入原始容器、缓存管理器和缓存对象的名称。</p> <h3 id="添加注解"><a href="#添加注解" class="header-anchor">#</a> 添加注解</h3> <p>如果使用 <code>@ContainerMethod</code> 声明的方法容器，可以在方法上添加 <code>@ContainerCache</code> 注解或 <code>@CacheContainerMethod</code> 组合注解，将方法容器声明为可缓存容器。</p> <p>示例代码如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ContainerCache</span> <span class="token comment">// 声明该方法容器为可缓存容器</span>
<span class="token annotation punctuation">@ContainerMethod</span><span class="token punctuation">(</span>resultType <span class="token operator">=</span> <span class="token class-name">Foo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Foo</span><span class="token punctuation">&gt;</span></span> <span class="token function">oneToManyMethod</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> args<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>key <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>或者使用 <code>@CacheContainerMethod</code> 组合注解：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@CacheContainerMethod</span><span class="token punctuation">(</span>resultType <span class="token operator">=</span> <span class="token class-name">Foo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Foo</span><span class="token punctuation">&gt;</span></span> <span class="token function">oneToManyMethod</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> args<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>key <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>方法容器创建后，会自动包装为缓存容器。</p> <h3 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h3> <p>可以在配置文件中声明要将哪些容器包装为缓存容器。</p> <p>示例配置如下（YAML 格式）：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">crane4j</span><span class="token punctuation">:</span>
  <span class="token key atrule">cache-containers</span><span class="token punctuation">:</span>
    <span class="token key atrule">cache-name</span><span class="token punctuation">:</span> container<span class="token punctuation">-</span>namespace
</code></pre></div><p>上述配置中，声明了将命名空间为 <code>container-namespace</code> 的容器包装为缓存容器，并使用了指定的缓存名称 <code>cache-name</code>。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/crane4j/basic/operation_sort.html" class="prev">
        顺序填充
      </a></span> <span class="next"><a href="/crane4j/advanced/combination_annotation.html">
        组合注解
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/crane4j/assets/js/app.143d5804.js" defer></script><script src="/crane4j/assets/js/2.c1e52383.js" defer></script><script src="/crane4j/assets/js/11.953399d4.js" defer></script>
  </body>
</html>
