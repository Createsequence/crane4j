## 概述

crane4j 提供了基于 Jackson 的扩展插件，启用后，用户可以在通过 `ObjectMapper` 将对象序列化为 JSON 字符串的时候进行字段填充，该填充完全兼容已有的各项配置。

并且，由于 JsonNode 的特殊性，该填充可以在属性映射时“凭空”为对象添加原本不具备的属性，在默认使用 Jackson 进行序列化的 SpringMVC 应用中，引入该扩展会带来不少的便利。

## 6.2.1.安装

### 6.2.1.1.引入依赖

在开始前，请先确保已经引入必要的 crane4j 配置，然后在此基础上，额外的引入下述依赖：

~~~xml
<!-- 引入 crane4j-extension-jackson -->
<dependency>
    <groupId>cn.crane4j</groupId>
    <artifactId>crane4j-extension-jackson</artifactId>
    <version>${last-version}</version>
</dependency>

<!-- 引入 jackson 依赖，若已有则可以跳过 -->
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
    <version>${last-version}</version>
</dependency>
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-core</artifactId>
    <version>${last-version}</version>
</dependency>
~~~

然后在启动类上添加 `@EnableCrane4j` 或单独添加 `@EnableCrane4jJacksonExtension` 注解即可：

~~~java
@EnableCrane4j
@SpringBootApplication
public class MbossChargeApplication {
    public static void main(String[] args) {
        SpringApplication.run(MbossChargeApplication.class, args);
    }
}
~~~

### 6.2.1.2.在 Spring 环境中使用

此扩展插件基于 `ObjectMapper` 的 `Module` 机制实现，因此在使用前，请确保 Spring 容器有且仅有一个可用的 `ObjectMapper`，在项目启动后，会自动将对应的模块注册到该实例中，后续直接使用即可。

若容器中存在多个 `ObjectMapper`，则需要按下述方式进行手动配置：

~~~java
// 在 Spring 环境中，请将 module 注册到你需要的 ObjectMapper 实例中
@Autowried
private JsonNodeAutoOperateModule jsonNodeAutoOperateModule;
@Autowried
private ObjectMapper objectMapper;

private void init() {
    objectMapper.registerModule(jsonNodeAutoOperateModule);
}
~~~

当使用注册有 `JsonNodeAutoOperateModule` 的 `ObjectMapper` 序列化对象时，自动填充将会生效。

### 6.2.1.3.在非 Spring 环境中使用

若你在非 Spring 环境中，则需要按如下方式配置 `ObjectMapper`：

~~~java

ObjectMapper objectMapper = new ObjectMapper();
sonNodeAssistant<JsonNode> jsonNodeAssistant = new JacksonJsonNodeAssistant(objectMapper);
        JsonNodePropertyOperator propertyOperator = new JsonNodePropertyOperator(jsonNodeAssistant, new ReflectivePropertyOperator());

~~~

