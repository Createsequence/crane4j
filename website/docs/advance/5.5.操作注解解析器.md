## 操作注解解析器

在`crane4j`中，通过各种注解去声明操作配置，比如 `@Assemble`、`@Disassemble`、`@AssembleEnum` 和 `@AssembleMp`，我们称这用于声明操作的注解为**操作注解**。它们底层实际上依赖于解析器中对应的操作注解处理器 `OperationAnnotationHandler` 实现。

`crane4j` 在这部分功能基于典型的责任链模式实现，在开始解析配置前，我们注册一系列操作注解处理器 `OperationAnnotationHandler` 到 `BeanOperationParser` 中，每个解析器都用于解析一组特定的注解。

当我们将一个需要解析的 `AnnotatedElement` 传递给`Parser`时，`Parser` 将创建一个 `BeanOperations` 配置对象，并驱动它在处理器链上流转。每个解析器根据规则将 `AnnotatedElement` 上的特定注解解析为对应的装配或拆卸配置。

下图展示了解析器的工作流程：

![](http://img.xiajibagao.top/%E6%97%A0%E6%A0%87%E9%A2%98-2023-06-04-1303.png)

`crane4j`目前提供了四个内置的操作注解处理器：

- `AssembleAnnotationResolver`：用于解析`@Assemble`注解，生成装配操作；
- `DisassembleAnnotationResolver`：用于解析`@Disassemble`注解，生成拆卸操作；
- `AssembleEnumAnnotationResolver`：用于解析`@AssembleEnum`注解，生成装配操作；
- `AssembleMpAnnotationResolver`：用于解析`@AssembleMp`注解，生成以 MyBatis-Plus 查询方法作为数据源的装配操作；

如果用户希望支持处理自定义的操作注解，可以实现 `OperationAnnotationHandler` 接口创建自定义解析器。

在Spring环境中，只需将自定义解析器交给Spring管理，它会在项目启动后自动注册到`Parser`中。如果在非Spring环境中，可以获取`TypeHierarchyBeanOperationParser` 并调用 `addOperationAnnotationHandler` 方法手动注册自定义解析器。
